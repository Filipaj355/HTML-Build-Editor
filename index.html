<!DOCTYPE html>
<html>
    <head>
        <script src="https://code.jquery.com/jquery-3.6.1.min.js"
        integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ="
        crossorigin="anonymous"></script>

        <script src="js/prism_logic.js"></script>
        <!-- see here for more info -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js"></script>
        <link rel='stylesheet' href='css/prism.css' type='text/css'>
        
        <!-- PRODUCTION / Brightspace: if we need to put it back in brightspace - it needs the CSS local
        <script src="https://learn.inside.dtu.dk/content/enforced/137173-OFFERING-Sandbox-41WPG/prism_logic.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js"></script>
        <script>
            document.head.innerHTML += "<link rel='stylesheet' href='https://learn.inside.dtu.dk/content/enforced/137173-OFFERING-Sandbox-41WPG/prism.css' type='text/css'/>";
        </script>
        -->

    </head>
    <body>
        <h1> HTML-Build-Editor</h1>
        <!-- this is the prism code that allows us to display and edit the code-->
        <!-- TODO: Think how to alternatively show the result - iframe? i know... but what are the other options?-->
        <div>
            <textarea cols="80" rows="80" placeholder="Enter HTML Source Code" id="editing" spellcheck="false" oninput="update(this.value); sync_scroll(this);" onscroll="sync_scroll(this);" onkeydown="check_tab(this, event);"></textarea>
            <pre id="highlighting" aria-hidden="true"><code class="language-css" id="highlighting-content"></code></pre>
        </div>
        
        <!-- some buttons with hardcoded links to the files ... -->
        <!-- TODO: Turn this into a function ? are we allowed PHP? -->
        <div>
            <button onclick="">View Page</button>
            <button onclick="popIt('index.html'); document.getElementById('highlighting-content').className ='language-html';">Load HTML</button></p>
            <button onclick="popIt('main.css');document.getElementById('highlighting-content').className ='language-css';">Load CSS</button>
            <button onclick="popIt('main.js');document.getElementById('highlighting-content').className ='language-js';">Load JS</button>
        </div>
        
        <script type="text/javascript">

            /* This is all taken from teh original prism example
            TODO: Clean it up ...*/
        
        function saveTextAsFile()
        {
            var textToSave = document.getElementById("inputTextToSave").value;
            var textToSaveAsBlob = new Blob([textToSave], {type:"text/plain"});
            var textToSaveAsURL = window.URL.createObjectURL(textToSaveAsBlob);
            var fileNameToSaveAs = document.getElementById("inputFileNameToSaveAs").value;
        
            var downloadLink = document.createElement("a");
            downloadLink.download = fileNameToSaveAs;
            downloadLink.innerHTML = "Download File";
            downloadLink.href = textToSaveAsURL;
            downloadLink.onclick = destroyClickedElement;
            downloadLink.style.display = "none";
            document.body.appendChild(downloadLink);
        
            downloadLink.click();
        }
        function destroyClickedElement(event)
        {
            document.body.removeChild(event.target);
        }
        function popIt(name)
        {
            // PRODUCTION: if we need to put it back in brightspace - it is currently junking out all the html....
            // var file = "https://learn.inside.dtu.dk/content/enforced/137173-OFFERING-Sandbox-41WPG/"+name;

            // TODO: This should be edited so that it just gets the selected group 
            var file = "1337/"+name;

        $.get( file, function( data ) {
        document.getElementById("editing").value = data;
            update(document.getElementById("editing").value);
        });
        
        
        }
        
        function loadFileAsText()
        {
            var fileToLoad = document.getElementById("fileToLoad").files[0];
        
            var fileReader = new FileReader();
            fileReader.onload = function(fileLoadedEvent) 
            {
                var textFromFileLoaded = fileLoadedEvent.target.result;
                document.getElementById("inputTextToSave").value = textFromFileLoaded;
            };
            fileReader.readAsText(fileToLoad, "UTF-8");
        }
        
        </script>
    
    </body>

</html>